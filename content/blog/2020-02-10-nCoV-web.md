---
title: "åŸºäº Serverless å¿«é€Ÿå®šåˆ¶ä½ æ‰€åœ¨åŸå¸‚çš„ nCoV ç–«æƒ…æŸ¥è¯¢é¡µ"
description: "æœ¬æ–‡åˆ†äº«äº†åŸºäº Serverless å®ç°ä¸€ä¸ªç–«æƒ…æŸ¥è¯¢é¡µçš„å®ç°é€»è¾‘å’Œéƒ¨ç½²è¿‡ç¨‹"
keywords: Serverless nCoV ç–«æƒ…æŸ¥è¯¢é¡µ,Serverless å®ç°é€»è¾‘,Serverless éƒ¨ç½²è¿‡ç¨‹
date: 2020-02-10
thumbnail: "https://img.serverlesscloud.cn/2020212/1581508115042-%E7%96%AB%E6%83%85.jpg"
categories:
  - user-stories
authors:
  - Tinafangkunding
authorslink:
  - http://github.com/tinafangkunding/
tags:
  - serverless
  - Meetup  
---

![ç–«æƒ…å±•ç¤ºå›¾](https://img.serverlesscloud.cn/2020212/1581508115042-%E7%96%AB%E6%83%85.jpg)

æ¯å¤©çœ‹åˆ°åˆ·å±çš„ç–«æƒ…äººæ•°å¢é•¿ï¼Œéš¾å…ä¼šæ„Ÿåˆ°ç„¦è™‘å’Œææ…Œã€‚åšä¸»æœ¬äººèº«åœ¨æ·±åœ³ï¼Œæœ€è¿‘ä¼ä¸šé€æ­¥å¼€å§‹å¤å·¥ï¼Œæ›´å¸Œæœ›å¯ä»¥å¯†åˆ‡ç›‘æ§è‡ªå·±æ‰€åœ¨åŸå¸‚çš„ç–«æƒ…æ–°å¢æƒ…å†µå’Œè¶‹åŠ¿ï¼Œæ–¹ä¾¿æŒæ¡ä¿¡æ¯ã€‚

å› æ­¤å€ŸåŠ© Serverless å¿«é€Ÿå®šåˆ¶äº†æ·±åœ³å¸‚çš„ç–«æƒ…æ•°æ®é¡µé¢ï¼Œè¿™é‡Œå°†å®ç°æ€è·¯å’Œä»£ç åˆ†äº«å‡ºæ¥ï¼Œå¸Œæœ›å„ä½ä¹Ÿå¯ä»¥åŸºäºè‡ªå·±çš„æ‰€åœ¨åŸå¸‚æ–¹ä¾¿æŸ¥çœ‹åˆ° æ–°å¢/ç´¯è®¡ çš„è¶‹åŠ¿å›¾ï¼Œæ›´å¥½åœ°å¯¹æŠ—ç–«æƒ…ã€‚

## å®ç°æ•ˆæœ
![Alt text](https://img.serverlesscloud.cn/2020212/1581480946201-1581479410309.png)
è¡¨æ ¼éƒ¨åˆ†çš„å®ç°æ•ˆæœæ˜¯è¿™æ ·çš„ï¼Œå¯ä»¥æ–¹ä¾¿çš„æŸ¥çœ‹åˆ°æ‰€åœ¨åŸå¸‚è¿‘ 10 å¤©æ¥çš„æ–°å¢ã€ç¡®è¯Šå’Œæ²»æ„ˆäººæ•°ï¼Œå¹¶ä¸”æ¯æ—¥æ›´æ–°ã€‚

## å®ç°é€»è¾‘

è¯¥ç–«æƒ…æ•°æ®å±•ç¤ºé¡µæ ¹æ® Serverless Framework æ„å»ºã€‚ä»£ç çš„æ”¹é€ åŸºäºè¯¥é¡¹ç›®[éƒ¨ç½² Serverless å…¨æ ˆ WEB åº”ç”¨ï¼ˆVue.jsï¼‰](https://github.com/serverless/components/tree/master/templates/tencent-fullstack-vue-application)

- å›¾è¡¨å±•ç¤ºéƒ¨åˆ†ä½¿ç”¨åˆ°äº† [v-charts](https://v-charts.js.org/#/)
- æ•°æ®æºçš„ json æ¥æºå¦‚ä¸‹ï¼Œå»ºè®®åšå¥½ç¼“å­˜ï¼Œä¸è¦é¢‘ç¹è°ƒç”¨ã€‚å¦‚æœå¸Œæœ›æŸ¥è¯¢å…¶ä»–åŸå¸‚ï¼Œå°† `city` å­—æ®µæ”¹ä¸ºå¯¹åº”çš„åŸå¸‚åå³å¯ã€‚æ¥å£æ–‡æ¡£è¯¦æƒ…å‚è€ƒ[æ­¦æ±‰è‚ºç‚å† çŠ¶ç—…æ¯’ç–«æƒ…ä¿¡æ¯æ¥å£ Api
](https://qinhaolei.com/posts/46178/)
`https://myapi.ihogu.com/public/?s=Whfy.city&city=%E6%B7%B1%E5%9C%B3`

é¦–å…ˆï¼Œåœ¨é¡¹ç›®ç›®å½•çš„ `serverless.yml` æ–‡ä»¶ä¸­ï¼Œç¯å¢ƒå˜é‡å¡«å†™äº†ä¸Šæ–‡ä¸­çš„æ•°æ®æº

```
name: tencent-fullstack-vue-application

dashboard:
  component: '@serverless/tencent-website'
  inputs:
    code:
      src: dist
      root: dashboard
      hook: npm run build
    env:
      apiUrl: ${api.url}
      apiUrlSZ: https://myapi.ihogu.com/public/?s=Whfy.city&city=%E6%B7%B1%E5%9C%B3

api:
  component: '@serverless/tencent-express'
  inputs:
    code: ./api
    functionName: tencent-fullstack-vue-api
    apigatewayConf:
      protocols:
        - https
```

ä¹‹åï¼Œåœ¨å‰ç«¯é¡µé¢ `dashboard/index.html` ä¸­ï¼Œå¢åŠ äº†å¯¹åº”çš„å›¾è¡¨å±•ç¤ºä»£ç ï¼š
```html
        <br>
        <div class="chart-source-data-box">
          <button v-on:click="queryServer">Get Server Time</button><br>
          <div style="color: aliceblue;">{{ message }}</div>
        </div>

        <br>
        <div class="sls-div tagline">
          ç‚¹å‡»æŸ¥è¯¢æ·±åœ³å¸‚ç–«æƒ…è¶‹åŠ¿å›¾
        </div>
        <div class="chart-source-data-box">
          <button @click="getPatient">Get Patients</button><br>
        </div>
        <div class="chart-wrapper">
          <div class="chart-no-data" v-if="chartData.rows.length === 0">No Data</div>
          <ve-line class="chart" :data="chartData" :extend="extend" :settings="chartSettings" height="100%" v-if="chartData.rows.length > 0"/>
        </div>
```

å…¶æ¬¡ï¼Œåœ¨  `dashboard/src/index.js` ä¸­ï¼Œå¢åŠ å¦‚ä¸‹é€»è¾‘ï¼Œç”¨äºè§£æç–«æƒ…çš„ Json æ•°æ®ï¼Œå¹¶ä¸”æ”¾å…¥è¡¨æ ¼ä¸­ã€‚

```javascript
'use strict'

require('../env')

const Vue = require('vue')
const VCharts = require('v-charts')

Vue.use(VCharts)

module.exports = new Vue({
  el: '#root',
  data () {
    this.extend = {
      series: {
        label: { normal: { show: true } }
      }
    },
    this.chartSettings = {
      labelMap:{
        'confirm': 'ç¡®è¯Šäººæ•°',
        'heal': 'æ²»æ„ˆäººæ•°',
        'suspect':'æ–°å¢äººæ•°'
      }
    }
    return {
      message: 'Click me!',
      isVisible: true,
      chartData: {
        columns: ['create_time','confirm','suspect','heal'],
        rows: []
      }
    }
  },
  methods: {
    async queryServer() {
      const response = await fetch(window.env.apiUrl)
      const result = await response.json()
      this.message = result.message
    },
    async getPatient() {
      const response = await fetch(window.env.apiUrlSZ)
      const result = await response.json()
      // handle chart data
      const rows = result.data.items;
      // add new patient
      for (var days = 0; days < rows.length-1; days++){
        rows[days].suspect = rows[days].confirm-rows[days+1].confirm;
      }
      rows.sort((a, b) => {
        return new Date(a.create_time) - new Date(b.create_time);
      })
      this.chartData.rows = rows
    }
  }
})
```

## å¿«é€Ÿéƒ¨ç½²

### 1. å®‰è£… Serverless æ¡†æ¶å’Œä¾èµ–

é¦–å…ˆï¼Œé€šè¿‡å¦‚ä¸‹å‘½ä»¤å®‰è£… [Serverless Framework](https://www.github.com/serverless/serverless):

```console
$ npm i -g serverless
```

ä¹‹åå¯ä»¥æ–°å»ºä¸€ä¸ªç©ºçš„æ–‡ä»¶å¤¹ï¼Œä½¿ç”¨ `create --template-url`ï¼Œå®‰è£…ç›¸å…³ templateã€‚

```console
$ serverless create --template-url https://github.com/tinafangkunding/nCov-page
```

ä½¿ç”¨ `cd` å‘½ä»¤ï¼Œè¿›å…¥ `\nCov-page` æ–‡ä»¶å¤¹ï¼Œå¯ä»¥æŸ¥çœ‹åˆ°å¦‚ä¸‹ç›®å½•ç»“æ„ï¼š

```
|- api
|- dashboard
|- serverless.yml      # ä½¿ç”¨é¡¹ç›®ä¸­çš„ yml æ–‡ä»¶
```

åœ¨ `\nCov-page` ç›®å½•ä¸‹ï¼Œè¿è¡Œå¦‚ä¸‹å‘½ä»¤åˆ†åˆ«å®‰è£…ç›®å½•ä¸‹çš„ NPM ä¾èµ–ï¼š
```console
$ npm run bootstrap
```
bootstrapä¼šè‡ªåŠ¨å®‰è£…ç›®å½•ä¸‹çš„ä¾èµ–ï¼Œè¾“å‡ºå¦‚ä¸‹æ‰€ç¤º
```console
> node scripts/bootstrap.js

Start install dependencies...

Root dependencies installed success.
Api dependencies installed success.
Dashboard dependencies installed success.
All dependencies installed.
```

### 2. éƒ¨ç½²åˆ°äº‘ç«¯

å›åˆ° `nCov-page` ç›®å½•ä¸‹ï¼Œç›´æ¥é€šè¿‡ `serverless` å‘½ä»¤æ¥éƒ¨ç½²åº”ç”¨:

```console
$ serverless
```

å¦‚æœå¸Œæœ›æŸ¥çœ‹éƒ¨ç½²è¯¦æƒ…ï¼Œå¯ä»¥é€šè¿‡è°ƒè¯•æ¨¡å¼çš„å‘½ä»¤ `serverless --debug` è¿›è¡Œéƒ¨ç½²ã€‚

å‡ºäºæˆæœ¬è€ƒè™‘ï¼Œè¿™ä¸ª web é¡µé¢å®Œå…¨æ­å»ºåœ¨è…¾è®¯äº‘äº‘å‡½æ•° SCFï¼Œå¯¹è±¡å­˜å‚¨ COS å’Œ API ç½‘å…³ç­‰æœåŠ¡ä¸Šã€‚åœ¨éƒ¨ç½²é˜¶æ®µï¼Œå¯ä»¥ç›´æ¥é€šè¿‡å¾®ä¿¡æ‰«æå‘½ä»¤è¡Œä¸­çš„äºŒç»´ç è¿›è¡Œè…¾è®¯äº‘çš„æˆæƒç™»é™†å’Œæ³¨å†Œã€‚

éƒ¨ç½²æˆåŠŸåï¼Œå¯ä»¥ç›´æ¥åœ¨æµè§ˆå™¨ä¸­è®¿é—®æ—¥å¿—ä¸­è¿”å›çš„ dashboard url åœ°å€ï¼ŒæŸ¥çœ‹è¯¥ç–«æƒ…æŸ¥è¯¢é¡µçš„æ•ˆæœ:

```bash
  dashboard: 
    url: http://9u9ywac-n56qlg-1251971143.cos-website.ap-guangzhou.myqcloud.com
    env: 
      apiUrl:   https://service-l77nemo2-1251971143.gz.apigw.tencentcs.com/release/
      apiUrlSZ: https://myapi.ihogu.com/public/?s=Whfy.city&city=%E6%B7%B1%E5%9C%B3
  api: 
    region:              ap-guangzhou
    functionName:        tencent-fullstack-vue-api
    apiGatewayServiceId: service-l77nemo2
    url:                 https://service-l77nemo2-1251971143.gz.apigw.tencentcs.com/release/

  21s â€º dashboard â€º done
```

è¯¥ç¤ºä¾‹åŸºäº[è…¾è®¯äº‘ Serverless Framework](https://cloud.tencent.com/product/sf) å®ç°ï¼Œç–«æƒ…é¡µæœ¬èº«æ˜¯é™æ€å±•ç¤ºï¼Œä½†æœ¬æ¬¡çš„æ¨¡æ¿éƒ¨ç½²ä¹Ÿæ­å»ºäº† express.js çš„åç«¯æ¡†æ¶ï¼Œå¹¶ä¸”ç®€å•å®ç°äº†ä»å‰ç«¯é¡µé¢è·å–åç«¯æœåŠ¡å™¨æ—¶é—´ Server Time çš„é€»è¾‘ï¼Œå› æ­¤å¯ä»¥æ–¹ä¾¿åœ°æ‰©å±•æ›´å¤šåŠŸèƒ½ã€‚æ¬¢è¿æ pr å’Œ issue ğŸ‘‰ [nCov-page é¡¹ç›®](https://github.com/tinafangkunding/nCov-page)ã€‚

> **ä¼ é€é—¨ï¼š**
>
> - GitHub: [github.com/serverless](https://github.com/serverless/serverless/blob/master/README_CN.md) 
> - å®˜ç½‘ï¼š[serverless.com](https://serverless.com/)

æ¬¢è¿è®¿é—®ï¼š[Serverless ä¸­æ–‡ç½‘](https://serverlesscloud.cn/)ï¼Œæ‚¨å¯ä»¥åœ¨ [æœ€ä½³å®è·µ](https://serverlesscloud.cn/best-practice/) é‡Œä½“éªŒæ›´å¤šå…³äº Serverless åº”ç”¨çš„å¼€å‘ï¼